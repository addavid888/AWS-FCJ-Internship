<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../images/favicon.png type=image/png><title>Dynamically routing requests with Amazon API Gateway routing rules :: Internship Report</title>
<link href=../../css/nucleus.css?1761062074 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1761062074 rel=stylesheet><link href=../../css/hybrid.css?1761062074 rel=stylesheet><link href=../../css/featherlight.min.css?1761062074 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1761062074 rel=stylesheet><link href=../../css/auto-complete.css?1761062074 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1761062074 rel=stylesheet><link href=../../css/theme.css?1761062074 rel=stylesheet><link href=../../css/hugo-theme.css?1761062074 rel=stylesheet><link href=../../css/theme-workshop.css?1761062074 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1761062074></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../3-blogstranslated/3.1-blog1/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1761062074></script><script type=text/javascript src=../../js/auto-complete.js?1761062074></script><script type=text/javascript>var baseurl="https://addavid888.github.io/AWS-FCJ-Internship/"</script><script type=text/javascript src=../../js/search.js?1761062074></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title="Week 2 Worklog" class=dd-item><a href=../../1-worklog/1.2-week2/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title=Proposal class=dd-item><a href=../../2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Dynamically routing requests with Amazon API Gateway routing rules" class="dd-item
active"><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Dynamically routing requests with Amazon API Gateway routing rules
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Introducing an agentic coding experience in Visual Studio and JetBrains IDEs" class=dd-item><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Introducing an agentic coding experience in Visual Studio and JetBrains IDEs
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Location Intelligence for Sustainable Transportation on AWS" class=dd-item><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Location Intelligence for Sustainable Transportation on AWS
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/ title=Workshop class=dd-item><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-s3-vpc/ title="Access S3 from VPC" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/><b>5.3. </b>Access S3 from VPC
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/ title="Create a gateway endpoint" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/5.3.1-create-gwe/><b>5.3.1 </b>Create a gateway endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/ title="Test the Gateway Endpoint" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/5.3.2-test-gwe/><b>5.3.2 </b>Test the Gateway Endpoint
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.4-s3-onprem/ title="Access S3 from on-premises" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/><b>5.4. </b>Access S3 from on-premises
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.1-prepare/ title="Prepare the environment" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.1-prepare/><b>5.4.1 </b>Prepare the environment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/ title="Create an S3 Interface endpoint" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/><b>5.4.2 </b>Create an S3 Interface endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/ title="Test the Interface Endpoint" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/><b>5.4.3 </b>Test the Interface Endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/ title="On-premises DNS Simulation" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/><b>5.4.4 </b>On-premises DNS Simulation
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.5-policy/ title="VPC Endpoint Policies" class=dd-item><a href=../../5-workshop/5.5-policy/><b>5.5. </b>VPC Endpoint Policies
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.6-cleanup/ title="Clean up" class=dd-item><a href=../../5-workshop/5.6-cleanup/><b>5.6. </b>Clean up
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Sharing and Feedback" class=dd-item><a href=../../7-feedback/><b>7. </b>Sharing and Feedback
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://addavid888.github.io/AWS-FCJ-Internship/3-blogstranslated/3.1-blog1/ selected>English</option><option id=vi value=https://addavid888.github.io/AWS-FCJ-Internship/vi/3-blogstranslated/3.1-blog1/>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span style=color:orange>21-10-2025 10:54 PM</span>
</i></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../>Internship Report</a> > <a href=../../3-blogstranslated/>Translated Blogs</a> > Dynamically routing requests with Amazon API Gateway routing rules</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#dynamic-routing-rules-overview>Dynamic Routing Rules Overview</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Dynamically routing requests with Amazon API Gateway routing rules</h1><p><a href=https://aws.amazon.com/vi/blogs/compute/dynamically-routing-requests-with-amazon-api-gateway-routing-rules/>Click here to read the orignal post</a></p><p><em>by Anton Aleksandrov and Giedrius Praspaliauskas on 03 JUN 2025</em></p><p>Effective API management and routing capabilities are crucial for organizations managing complex application architectures. Whether you’re a technology company rolling out new API versions to millions of users, or a financial services organization conducting A/B tests to optimize customer experiences, the ability to route API traffic dynamically and efficiently is essential.</p><p>Today, <a href=https://aws.amazon.com/api-gateway/>Amazon API Gateway</a> announces support for dynamic routing rules for <a href=https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-custom-domains.html>custom domain names</a> in all supported <a href=https://aws.amazon.com/about-aws/global-infrastructure/regions_az/>AWS Regions</a>. This new capability enables you to route API requests based on HTTP header values, either independently or in combination with URL paths. In this post, you will learn how to use this new capability to implement routing strategies such as API versioning and gradual rollouts without modifying your API endpoints.</p><h2 id=dynamic-routing-rules-overview>Dynamic Routing Rules Overview</h2><p>Many organizations require dynamic API routing capabilities to support their evolving business needs. As a line-of-business persona, you want to be able to test new user experiences with specific customer segments, while maintaining their existing flows intact. As an engineer, you want to be able to maintain multiple API versions across different client applications while ensuring regulatory compliance. Prior to this launch, developers using API Gateway implemented dynamic routing by using different URL paths, such as “<strong>/v1/products</strong>” and “<strong>/v2/products</strong>”.</p><p>With this new launch, you can implement dynamic routing logic with a simple declarative configuration within the custom domain name settings. The new routing rule mechanism allows you to make routing decisions based on HTTP headers, base paths, or a combination of both. Developers are no longer required to create new or alter existing paths to smoothly transition between API versions, they can simply specify the desired value in the request HTTP header. Among other possibilities, you can implement cell-based architecture routing, A/B testing, or dynamic backend selection based on <a href=https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-custom-domains.html#wildcard-custom-domain-names>hostname</a>, tenant ID, accepted response media type, or cookie value. By implementing routing logic directly within the API Gateway, you can eliminate proxy layers and complex URL structures while maintaining fine-grained control over your API traffic. This new feature seamlessly integrates with existing API Gateway capabilities and supports both public and private REST APIs. The following diagram shows how you can use routing rules for header and base-path based routing. This example uses a single level resource /products to show path matching, however depending on your use-case you could also use multi-level paths like <strong>/products/items</strong>.</p><p><img alt=image-1 src=../../images/3-BlogsTranslated/3.1/image-1.jpg></p><p>Figure 1. Using routing rules for header and base-path based routing</p><p>In the following section you’ll learn how to implement header-based routing, use the new routing rules construct for common scenarios like API versioning and A/B testing, and configure rules with different routing conditions and priorities to achieve the desired behavior.</p><p><strong>What is a routing rule</strong></p><p>A <a href=https://docs.aws.amazon.com/apigateway/latest/developerguide/rest-api-routing-mode.html>routing rule</a> is a new resource type uniquely associated with a single custom domain. It represents a collection of conditions that, when matched, cause the incoming request to be forwarded to a specific API and stage. Routing rules have three configuration properties:</p><ul><li><p>The Conditions property defines the criteria that must be met for actions to be taken. A rule can include up to two header conditions and one base path condition, and all specified conditions must be met to trigger the action. If no conditions are defined for a rule, it serves as a catch-all rule matching all requests.</p></li><li><p>The Actions property defines what actions will be taken when rule conditions are met. At the time of this launch the supported action is invoking any stage of any REST API within the same account and region boundaries.</p></li><li><p>The Priority property defines the order that rules are evaluated in, with 1 being highest priority and 1,000,000 the lowest. You cannot reuse same priority value for more than one rule. AWS recommends you leave ample space between sequential rules to make it easy to add new rules in future, for example use 100, 200, 300 instead of 1, 2, 3.</p></li></ul><p>Header conditions, specified via a <strong>MatchHeaders</strong> property, are used to match HTTP request header values, such as x-<strong>version=v1</strong>. Conforming to <a href=https://datatracker.ietf.org/doc/html/rfc7230>RFC 7230</a>, header names are not case sensitive, while header values are. You can also use wildcards in header values for prefix, suffix, and contains match. See the following examples using <a href=https://aws.amazon.com/cloudformation/>AWS CloudFormation</a> templates:</p><p><strong>Exact match:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>MatchHeaders</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>AnyOf</span>:
</span></span><span style=display:flex><span>		- <span style=color:#f92672>Header</span>: <span style=color:#e6db74>&#34;x-version&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>ValueGlob</span>: <span style=color:#e6db74>&#34;alpha-v2-latest&#34;</span>
</span></span></code></pre></div><p>Will only match x-version=alpha-v2-latest</p><p><strong>Prefix match:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>MatchHeaders</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>AnyOf</span>:
</span></span><span style=display:flex><span>	- <span style=color:#f92672>Header</span>: <span style=color:#e6db74>&#34;x-version&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>ValueGlob</span>: <span style=color:#e6db74>&#34;*latest&#34;</span>
</span></span></code></pre></div><p>Matches x-version=alpha-v2-latest, but not x-version=alpha-v2</p><p><strong>Suffix match:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>MatchHeaders</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>AnyOf</span>:
</span></span><span style=display:flex><span>		- <span style=color:#f92672>Header</span>: <span style=color:#e6db74>&#34;x-version&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>ValueGlob</span>: <span style=color:#e6db74>&#34;alpha*&#34;</span>
</span></span></code></pre></div><p>Will match x-version=alpha-v2-latest and x-version=alpha-v1, but not x-version=beta-v1</p><p><strong>Prefix and suffix match.</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>MatchHeaders</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>AnyOf</span>:
</span></span><span style=display:flex><span>		- <span style=color:#f92672>Header</span>: <span style=color:#e6db74>&#34;x-version&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>ValueGlob</span>: <span style=color:#e6db74>&#34;*v2*&#34;</span>
</span></span></code></pre></div><p>Matches x-version=alpha-v2-latest and x-version=beta-v2-test, but not x-version=alpha-v1</p><p>Base path condition, specified via <strong>MatchBasePaths</strong> property, is used to match the incoming request path. The matching is case sensitive.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>MatchBasePaths</span>: 
</span></span><span style=display:flex><span>	<span style=color:#f92672>AnyOf</span>: 
</span></span><span style=display:flex><span>		- <span style=color:#e6db74>&#34;products&#34;</span>
</span></span></code></pre></div><p>You can have up to two <strong>MatchHeaders</strong> and one <strong>MatchBasePaths</strong> conditions per routing rule. Conditions are evaluated using the <strong>AND</strong> operator, meaning all conditions must be met for the action to be taken. Both condition types support a single comparison value under <strong>AnyOf</strong> property. The following snippet illustrates a sample routing rule with two <strong>MatchHeaders</strong> conditions and a single <strong>MatchBasePaths</strong> condition.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ProductsV1RoutingRule</span>: 
</span></span><span style=display:flex><span>	<span style=color:#f92672>Type</span>: <span style=color:#e6db74>&#39;AWS::ApiGatewayV2::RoutingRule&#39;</span> 
</span></span><span style=display:flex><span>	<span style=color:#f92672>Properties</span>: 
</span></span><span style=display:flex><span>		<span style=color:#f92672>DomainNameArn</span>: !<span style=color:#ae81ff>Sub &#34;arn:aws:apigateway:${AWS::Region}::/domainnames/${ApiCustomDomain}&#34; </span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>Priority</span>: <span style=color:#ae81ff>100</span> 
</span></span><span style=display:flex><span>		<span style=color:#f92672>Conditions</span>: 
</span></span><span style=display:flex><span>			- <span style=color:#f92672>MatchHeaders</span>: 
</span></span><span style=display:flex><span>				<span style=color:#f92672>AnyOf</span>: 
</span></span><span style=display:flex><span>					- <span style=color:#f92672>Header</span>: <span style=color:#e6db74>&#34;x-version&#34;</span> 
</span></span><span style=display:flex><span>					<span style=color:#f92672>ValueGlob</span>: <span style=color:#e6db74>&#34;v2&#34;</span> 
</span></span><span style=display:flex><span>			- <span style=color:#f92672>MatchHeaders</span>: 
</span></span><span style=display:flex><span>				<span style=color:#f92672>AnyOf</span>: 
</span></span><span style=display:flex><span>					- <span style=color:#f92672>Header</span>: <span style=color:#e6db74>&#34;x-user-cohort&#34;</span> 
</span></span><span style=display:flex><span>					<span style=color:#f92672>ValueGlob</span>: <span style=color:#e6db74>&#34;beta-testers&#34;</span> 
</span></span><span style=display:flex><span>			- <span style=color:#f92672>MatchBasePaths</span>: 
</span></span><span style=display:flex><span>				<span style=color:#f92672>AnyOf</span>: 
</span></span><span style=display:flex><span>					- <span style=color:#e6db74>&#34;products&#34;</span> 
</span></span><span style=display:flex><span>		<span style=color:#f92672>Actions</span>: 
</span></span><span style=display:flex><span>				- <span style=color:#f92672>InvokeApi</span>:
</span></span><span style=display:flex><span>					<span style=color:#f92672>ApiId</span>: !<span style=color:#ae81ff>Ref ProductsV2Api </span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>Stage</span>: !<span style=color:#ae81ff>Ref ProductsV2Stage</span>
</span></span></code></pre></div><p>This rule matches requests to <a href=https://example.com/products>https://example.com/products</a> when both header conditions are met <strong>– x-version=v2</strong> and <strong>x-user-cohort=beta-testers</strong>. This rule does not match requests to any other base path, such as <a href=https://example.com/orders>https://example.com/orders</a>, or requests that do not match at least one header condition.</p><p>For scenarios like API versioning, you can create rules that evaluate headers such as <strong>“accept”</strong> or <strong>“version”</strong> to route traffic to different API implementations. For example, to route requests containing <strong>“x-version: api-beta”</strong> to your beta API, you would create a rule specifying this header condition and set the action to route to your beta API deployment.</p><p>Header-based routing also simplifies A/B testing by allowing you to define client cohorts based on custom headers, allowing controlled experiments with different configurations. You can create rules that check for a custom header like <strong>“x-test-group”</strong> to route specific users to different API implementations. The priority system ensures predictable routing behavior – when multiple rules match a request, the rule with the lowest priority number (highest precedence) determines the routing. Combining header and path conditions within a single rule enables complex routing scenarios such as version-specific routing for specific API resources instead of the entire API, as illustrated in the following diagram.</p><p><img alt=image-2 src=../../images/3-BlogsTranslated/3.1/image-2-1.jpg></p><p>Figure 2. A routing configuration with two header and one path conditions in API Gateway Console.</p><p>Review the API Gateway <a href=https://docs.aws.amazon.com/apigateway/latest/developerguide/rest-api-routing-mode.html>documentation</a> for detailed guide on creating routing rules.</p><p><strong>Configuring Routing Mode</strong></p><p>Before you begin creating routing rules, you must first create at least one API, stage, and a custom domain name. You can configure your custom domain name with the new routing mode setting.</p><ul><li><p><strong>API mappings only.</strong> This is the default mode. When using this mode, you can continue to use base path mappings to route requests to different APIs, and not use Routing Rules at all. This mode maintains the current behavior, where requests are routed based on base path mappings only.</p></li><li><p><strong>Routing rules then API mappings.</strong> With this mode you can use Routing Rules while continuing to keep base path mappings as a fallback. When you use this mode, the Routing Rules always take precedence, and unmatched requests are evaluated against base path mappings. This mode is useful for gradually transitioning your APIs to Routing Rules.</p></li><li><p><strong>Routing rules only.</strong> This mode gives you the flexibility to use routing rules only, and not rely on the base paths that you may have previously created on the domain using API mappings. This is the recommended routing mode; it is helpful when you are starting off with a new custom domain or finished transitioning from API mappings to Routing Rules for an existing custom domain.</p></li></ul><p>When switching from one routing mode to another, always test your new configuration in non-production environments first. For example, when switching mode from API mappings only to routing rules only, your traffic will only be routed with routing rules; existing API mappings will no longer take effect.</p><p><strong>Onboarding to Header-Based Routing</strong></p><p>You can adopt the new Header-Based Routing for your existing API Gateway custom domains with zero-downtime, risk-minimized approach. The first step is to configure your custom domain to use the <strong>Routing rules then API mappings</strong> mode using the API Gateway console, <a href=https://aws.amazon.com/cli/>AWS CLI</a>, or your infrastructure-as-code (IaC) tool. This configuration ensures that while you gradually create Routing Rules, your existing base path mappings continue to function as fallback routes. Since Routing Rules are evaluated before base path mappings, and in the absence of any matching rules, requests automatically fall back to your existing base path mappings, your current API traffic remains unaffected during this transition.</p><p><strong>Observability</strong></p><p>API Gateway provides comprehensive visibility into how your routing rules are processing requests through <a href=https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-variables-for-access-logging.html>access logging</a>. Each request now includes additional context variables that help you understand the routing decision process. The <strong>$context.customDomain.routingRuleIdMatched</strong> variable identifies which rule was matched and applied to the request, while existing variables like <strong>$context.domainName</strong>, <strong>$context.apiId</strong>, and <strong>$context.stage</strong> provide the complete routing context. By analyzing these access logs, you can verify routing behavior, troubleshoot unexpected routes, and gather insights about traffic patterns across different API versions or test variants.</p><p><strong>End-to-end example</strong></p><p>Consider a real-world scenario where a team needs to gradually migrate users to a new API version, such as an e-commerce platform updating its checkout API from v1 to v2. First, the team creates two different REST APIs – one for each version. Then, they set up a Routing Rule with priority 100 that checks for the header <strong>x-version=v2</strong> and routes matching requests to the v2 API. They also create another rule with priority 200 that routes all requests with paths starting with <strong>/checkout</strong> to v1 API as a fallback.</p><p>Figure 3. Gradually transitioning clients from v1 to v2 API.</p><p>In the application code they add the <strong>x-version</strong> header for a small percentage of users. They monitor the performance and error rates using API Gateway’s telemetry capabilities by tracking the access and execution logs, along with emitted metrics. As their confidence grows, they gradually increase the percentage of users sending the v2 header. This approach ensures a controlled migration with minimal risk and ability to quickly rollback by simply removing the header from requests or changing a routing rule.</p><p><strong>Sample</strong></p><p>Follow the instructions in <a href=https://github.com/aws-samples/serverless-samples/tree/main/apigw-header-routing>this GitHub repository</a> to provision the sample in your AWS account. The project illustrates using dynamic routing with API Gateway.</p><p><strong>Conclusion</strong></p><p>Header-based routing brings significant advantages to API Gateway users. The feature’s backward compatibility ensures a smooth transition path – you can maintain existing base path mappings while gradually adopting Routing Rules, or use both mechanisms simultaneously with the fallback option. This flexibility allows you to migrate at your own pace without disrupting existing applications. The solution is cost-effective, with no additional charges for using Routing Rules on REST APIs. It reduces requirements to leverage extra service and infrastructure for dynamic routing. The priority-based evaluation system provides deterministic routing behavior, making it easier to understand and troubleshoot routing decisions.</p><p>To learn more about API Gateway header-based routing see the <a href=https://docs.aws.amazon.com/apigateway/latest/developerguide/rest-api-routing-mode.html>service documentation</a>.</p><p>To learn more about Serverless architectures see <a href=https://serverlessland.com/>Serverless Land</a>.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../3-blogstranslated/ title="Translated Blogs"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../3-blogstranslated/3.2-blog2/ title="Introducing an agentic coding experience in Visual Studio and JetBrains IDEs" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1761062074></script><script src=../../js/perfect-scrollbar.min.js?1761062074></script><script src=../../js/perfect-scrollbar.jquery.min.js?1761062074></script><script src=../../js/jquery.sticky.js?1761062074></script><script src=../../js/featherlight.min.js?1761062074></script><script src=../../js/highlight.pack.js?1761062074></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1761062074></script><script src=../../js/learn.js?1761062074></script><script src=../../js/hugo-learn.js?1761062074></script><link href=../../mermaid/mermaid.css?1761062074 rel=stylesheet><script src=../../mermaid/mermaid.js?1761062074></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>